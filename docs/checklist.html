<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Legal Services Portal - Document Checklist</title>
    <link rel="stylesheet" href="style.css">
    <script>
        (function() {
            var auth = localStorage.getItem('legal-portal-auth');
            var authTime = localStorage.getItem('legal-portal-auth-time');
            var maxAge = 24 * 60 * 60 * 1000;
            if (auth !== 'authenticated' || !authTime || (Date.now() - parseInt(authTime)) > maxAge) {
                window.location.href = 'index.html';
            }
        })();
    </script>
    <style>
        .checklist-item {
            display: flex;
            align-items: flex-start;
            padding: 16px;
            border: 1px solid var(--border);
            border-radius: 6px;
            margin-bottom: 10px;
            background: var(--bg-white);
        }
        .checklist-item.received { border-left: 3px solid var(--success); background: #ECFDF5; }
        .checklist-item.rejected { border-left: 3px solid var(--danger); background: #FEF2F2; }
        .checklist-checkbox { margin-right: 12px; margin-top: 2px; }
        .checklist-checkbox input { width: 18px; height: 18px; accent-color: var(--accent); }
        .checklist-content { flex: 1; }
        .checklist-title { font-weight: 500; margin-bottom: 4px; font-size: 14px; }
        .checklist-description { font-size: 13px; color: var(--text-secondary); margin-bottom: 6px; }
        .checklist-meta { font-size: 12px; color: var(--text-muted); }
        .checklist-actions { margin-left: 16px; }
        .status-select { padding: 6px 10px; font-size: 12px; border-radius: 4px; border: 1px solid var(--border); }
        .category-header {
            background: var(--bg-gray);
            padding: 10px 14px;
            border-radius: 4px;
            margin: 24px 0 12px 0;
            font-weight: 500;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.03em;
            color: var(--text-secondary);
        }
        .category-header:first-of-type { margin-top: 0; }
    </style>
</head>
<body>
    <div class="app-shell">
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">
                    <div class="sidebar-logo-icon"><svg viewBox="0 0 24 24"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></svg></div>
                    Legal Portal
                </div>
            </div>
            <div class="practice-selector">
                <label>Practice Area</label>
                <select class="practice-select" id="practiceSelect" onchange="switchPractice(this.value)">
                    <option value="immigration" selected>Immigration</option>
                    <option value="contracts">Contracts</option>
                    <option value="estate">Estate Planning</option>
                    <option value="general">General</option>
                </select>
            </div>
            <nav class="workflow-nav">
                <div class="workflow-label">Workflow</div>
                <ul class="workflow-steps">
                    <li class="workflow-step" onclick="window.location.href='intake.html'"><span class="step-indicator"><span class="step-number">1</span></span><span>Intake</span></li>
                    <li class="workflow-step active" onclick="window.location.href='checklist.html'"><span class="step-indicator"><span class="step-number">2</span></span><span>Documents</span></li>
                    <li class="workflow-step" onclick="window.location.href='forms.html'"><span class="step-indicator"><span class="step-number">3</span></span><span>Forms</span></li>
                    <li class="workflow-step" onclick="window.location.href='summary.html'"><span class="step-indicator"><span class="step-number">4</span></span><span>Summary</span></li>
                    <li class="workflow-step" onclick="window.location.href='deadlines.html'"><span class="step-indicator"><span class="step-number">5</span></span><span>File</span></li>
                </ul>
            </nav>
            <div class="sidebar-footer">
                <a href="about.html">How It Works</a>
                <a href="#" onclick="logout(); return false;">Sign Out</a>
            </div>
        </aside>

        <main class="main-content">
            <header class="top-bar">
                <span class="top-bar-title">Immigration â€” Documents</span>
                <div class="top-bar-actions"><a href="dashboard.html">Dashboard</a></div>
            </header>

            <div class="content-container wide">
                <div class="draft-notice"><strong>DRAFT - PENDING ATTORNEY REVIEW</strong><br>Document requirements may vary.</div>

                <div class="card" id="generatorSection">
                    <h2 style="margin-bottom: 8px;">Document Checklist</h2>
                    <p style="color: var(--text-secondary); margin-bottom: 24px;">Select a case type to generate a customized document checklist.</p>
                    <div class="form-row">
                        <div class="form-group"><label class="form-label">Case Type</label><select class="form-select" id="caseTypeSelect"><option value="">Select...</option><option value="family_adjustment">Family-Based Adjustment</option><option value="asylum">Asylum</option><option value="u_visa">U Visa</option><option value="naturalization">Naturalization</option><option value="tps">TPS</option><option value="work_permit">Work Permit</option></select></div>
                        <div class="form-group"><label class="form-label">Client Name</label><input type="text" class="form-input" id="clientName" placeholder="For tracking"></div>
                    </div>
                    <button class="btn btn-primary" onclick="generateChecklist()">Generate Checklist</button>
                </div>

                <div class="card" id="checklistSection" style="display: none;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <div><h2 id="checklistTitle" style="margin-bottom: 4px;">Checklist</h2><p class="text-sm text-muted" id="checklistSubtitle"></p></div>
                        <button class="btn btn-secondary btn-sm" onclick="showGenerator()">New Checklist</button>
                    </div>
                    <div class="progress-bar" style="margin-bottom: 20px;"><div class="progress-bar-fill" id="progressFill" style="width: 0%;"></div></div>
                    <div id="checklistItems"></div>
                    <div style="margin-top: 24px; display: flex; gap: 12px;">
                        <button class="btn btn-primary" onclick="saveChecklist()">Save</button>
                        <button class="btn btn-secondary" onclick="window.print()">Print</button>
                    </div>
                </div>

                <div class="card">
                    <h3>Saved Checklists</h3>
                    <div id="savedChecklists"><p class="text-muted">No saved checklists.</p></div>
                </div>
            </div>
        </main>
    </div>

    <script>
        const documentRequirements = {
            family_adjustment: { title: "Family-Based Adjustment", categories: { identity: [{ name: "Petitioner's Proof of Status", description: "Passport, naturalization cert, or green card", source: "USCIS", required: true },{ name: "Beneficiary's Passport", description: "Bio page with photo", source: "Personal", required: true },{ name: "Birth Certificate", description: "With translation", source: "Home country", required: true },{ name: "Photos", description: "2x2 passport style", source: "Photo service", required: true }], relationship: [{ name: "Marriage Certificate", description: "Government-issued", source: "County clerk", required: true },{ name: "Joint Financial Evidence", description: "Bank accounts, insurance", source: "Banks", required: false }], financial: [{ name: "Tax Returns (3 Years)", description: "With W-2s", source: "IRS", required: true },{ name: "Employment Letter", description: "Position and salary", source: "Employer", required: true }], medical: [{ name: "I-693 Medical Exam", description: "Sealed from civil surgeon", source: "Civil surgeon", required: true }] }},
            asylum: { title: "Asylum Application", categories: { identity: [{ name: "Passport", description: "All pages", source: "Personal", required: true },{ name: "Birth Certificate", description: "With translation", source: "Home country", required: true },{ name: "Photos", description: "2 passport-style", source: "Photo service", required: true }], evidence: [{ name: "Personal Declaration", description: "Detailed statement", source: "Client", required: true },{ name: "Country Conditions", description: "Reports and articles", source: "Research", required: true },{ name: "Medical Records", description: "If claiming harm", source: "Doctors", required: false }] }},
            u_visa: { title: "U Visa", categories: { identity: [{ name: "ID Documents", description: "Passport or national ID", source: "Personal", required: true },{ name: "Birth Certificate", description: "With translation", source: "Home country", required: true }], court: [{ name: "I-918B Certification", description: "From law enforcement", source: "Police/prosecutor", required: true },{ name: "Police Reports", description: "Related to crime", source: "Law enforcement", required: true }], evidence: [{ name: "Personal Statement", description: "Description of crime", source: "Client", required: true }] }},
            naturalization: { title: "Naturalization", categories: { identity: [{ name: "Green Card", description: "Front and back", source: "Personal", required: true },{ name: "Passport", description: "All during LPR period", source: "Personal", required: true },{ name: "Photos", description: "2 passport-style", source: "Photo service", required: true }], immigration: [{ name: "Travel History", description: "All trips outside US", source: "Personal", required: true },{ name: "Tax Returns (5 Years)", description: "Federal returns", source: "IRS", required: true }] }},
            tps: { title: "TPS", categories: { identity: [{ name: "Passport", description: "Proof of nationality", source: "Personal", required: true },{ name: "Birth Certificate", description: "Country of birth", source: "Home country", required: true }], immigration: [{ name: "I-94", description: "Presence evidence", source: "CBP", required: true },{ name: "Residence Evidence", description: "Bills, leases, etc.", source: "Various", required: true }] }},
            work_permit: { title: "Work Permit", categories: { identity: [{ name: "Passport", description: "Bio page", source: "Personal", required: true },{ name: "Photos", description: "2 passport-style", source: "Photo service", required: true },{ name: "I-94", description: "Arrival record", source: "CBP", required: true }], immigration: [{ name: "Pending Application Receipt", description: "I-797 notice", source: "USCIS", required: true }] }}
        };
        let currentChecklist = null;

        function generateChecklist() {
            const type = document.getElementById('caseTypeSelect').value;
            if (!type) { alert('Select a case type.'); return; }
            const reqs = documentRequirements[type];
            currentChecklist = { id: Date.now().toString(), caseType: type, title: reqs.title, clientName: document.getElementById('clientName').value, createdDate: new Date().toISOString(), documents: [] };
            let docId = 0;
            for (const [cat, docs] of Object.entries(reqs.categories)) {
                for (const doc of docs) {
                    currentChecklist.documents.push({ id: (++docId).toString(), category: cat, ...doc, status: 'not_started' });
                }
            }
            renderChecklist();
        }

        function renderChecklist() {
            document.getElementById('generatorSection').style.display = 'none';
            document.getElementById('checklistSection').style.display = 'block';
            document.getElementById('checklistTitle').textContent = currentChecklist.title;
            document.getElementById('checklistSubtitle').textContent = (currentChecklist.clientName ? `Client: ${currentChecklist.clientName} | ` : '') + `Created: ${new Date(currentChecklist.createdDate).toLocaleDateString()}`;

            const byCategory = {};
            currentChecklist.documents.forEach(d => { if (!byCategory[d.category]) byCategory[d.category] = []; byCategory[d.category].push(d); });
            const catNames = { identity: 'Identity', immigration: 'Immigration', relationship: 'Relationship', financial: 'Financial', medical: 'Medical', evidence: 'Evidence', court: 'Court Documents' };

            let html = '';
            for (const [cat, docs] of Object.entries(byCategory)) {
                html += `<div class="category-header">${catNames[cat] || cat}</div>`;
                for (const doc of docs) {
                    const isReceived = doc.status === 'received' || doc.status === 'verified';
                    html += `<div class="checklist-item ${isReceived ? 'received' : ''} ${doc.status === 'rejected' ? 'rejected' : ''}">
                        <div class="checklist-checkbox"><input type="checkbox" ${isReceived ? 'checked' : ''} onchange="toggleDoc('${doc.id}', this.checked)"></div>
                        <div class="checklist-content"><div class="checklist-title">${doc.name}${doc.required ? ' *' : ''}</div><div class="checklist-description">${doc.description}</div><div class="checklist-meta">Source: ${doc.source}</div></div>
                        <div class="checklist-actions"><select class="status-select" onchange="updateStatus('${doc.id}', this.value)"><option value="not_started" ${doc.status==='not_started'?'selected':''}>Not Started</option><option value="requested" ${doc.status==='requested'?'selected':''}>Requested</option><option value="received" ${doc.status==='received'?'selected':''}>Received</option><option value="verified" ${doc.status==='verified'?'selected':''}>Verified</option><option value="rejected" ${doc.status==='rejected'?'selected':''}>Rejected</option></select></div>
                    </div>`;
                }
            }
            document.getElementById('checklistItems').innerHTML = html;
            updateProgress();
        }

        function toggleDoc(id, checked) { const d = currentChecklist.documents.find(x => x.id === id); if (d) { d.status = checked ? 'received' : 'not_started'; renderChecklist(); } }
        function updateStatus(id, status) { const d = currentChecklist.documents.find(x => x.id === id); if (d) { d.status = status; renderChecklist(); } }
        function updateProgress() {
            const total = currentChecklist.documents.filter(d => d.required).length;
            const done = currentChecklist.documents.filter(d => d.required && (d.status === 'received' || d.status === 'verified')).length;
            document.getElementById('progressFill').style.width = (total ? Math.round(done/total*100) : 0) + '%';
        }
        function showGenerator() { document.getElementById('generatorSection').style.display = 'block'; document.getElementById('checklistSection').style.display = 'none'; }
        function saveChecklist() {
            const saved = JSON.parse(localStorage.getItem('legal-portal-checklists') || '[]');
            const idx = saved.findIndex(c => c.id === currentChecklist.id);
            if (idx >= 0) saved[idx] = currentChecklist; else saved.push(currentChecklist);
            localStorage.setItem('legal-portal-checklists', JSON.stringify(saved));
            loadSaved(); alert('Saved!');
        }
        function loadSaved() {
            const saved = JSON.parse(localStorage.getItem('legal-portal-checklists') || '[]');
            if (!saved.length) { document.getElementById('savedChecklists').innerHTML = '<p class="text-muted">No saved checklists.</p>'; return; }
            let html = '<table class="table"><thead><tr><th>Type</th><th>Client</th><th>Progress</th><th></th></tr></thead><tbody>';
            saved.forEach(c => {
                const total = c.documents.filter(d => d.required).length;
                const done = c.documents.filter(d => d.required && (d.status === 'received' || d.status === 'verified')).length;
                html += `<tr><td>${c.title}</td><td>${c.clientName||'-'}</td><td><span class="badge ${done===total?'badge-complete':'badge-pending'}">${total?Math.round(done/total*100):0}%</span></td><td><button class="btn btn-sm btn-secondary" onclick="loadChecklist('${c.id}')">Open</button></td></tr>`;
            });
            html += '</tbody></table>';
            document.getElementById('savedChecklists').innerHTML = html;
        }
        function loadChecklist(id) { currentChecklist = JSON.parse(localStorage.getItem('legal-portal-checklists') || '[]').find(c => c.id === id); if (currentChecklist) renderChecklist(); }
        function switchPractice(p) { localStorage.setItem('legal-portal-practice', p); window.location.href = 'dashboard.html'; }
        function logout() { localStorage.removeItem('legal-portal-auth'); localStorage.removeItem('legal-portal-auth-time'); window.location.href = 'index.html'; }
        loadSaved();
    </script>
</body>
</html>
